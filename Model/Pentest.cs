using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations.Schema;
using AutoWebPentester.API.Logic.AllWithPentests.Inputs;
using AutoWebPentester.API.Models;
using Newtonsoft.Json;

namespace AutoWebPentester.API.Model
{
    public class Pentest
    {
        public int Id { get; set; }
        public DateTime Date { get; set; }


        internal string _Input { get; set; }

        [NotMapped]
        public Input Input
        {
            get
            {
                return _Input == null ? null : JsonConvert.DeserializeObject<Input>(_Input,new JsonSerializerSettings{TypeNameHandling=TypeNameHandling.Auto});
            }
            set { _Input = JsonConvert.SerializeObject(value,new JsonSerializerSettings{TypeNameHandling=TypeNameHandling.Auto}); }
        }

        internal string _Outcome { get; set; }
        
        [NotMapped]
        public Outcome Outcome
        {
            get
            {
                return _Outcome == null ? null : JsonConvert.DeserializeObject<Outcome>(_Outcome,new JsonSerializerSettings{TypeNameHandling=TypeNameHandling.Auto});
            }
            set { _Outcome = JsonConvert.SerializeObject(value,new JsonSerializerSettings{TypeNameHandling=TypeNameHandling.Auto}); }
        }
        public string GetOutputAsString(){
            return _Outcome;
        }
        public string GetInputsAsString(){
            return _Input;
        }

        public void SetInputAsString(string s){
            this._Outcome=s;
        }

        public int UserId { get; set; }
        public User User { get; set; }

        public int PentestSketchId  { get; set; }
        public PentestSketch PentestSkech { get; set; }

        public int WebsiteId { get; set; }
        public WebSite WebSite{ get; set; }

        public IEnumerable<Outcome> Outcomes{ get; set; }  
    }
}