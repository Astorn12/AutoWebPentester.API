using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using AutoWebPentester.API.Data.ResourcesRepository;
using AutoWebPentester.API.Logic.AllWithPentests.Inputs;
using AutoWebPentester.API.Logic.AllWithPentests.Inputs.JsonConvertClasses;
using AutoWebPentester.API.Logic.AllWithPentests.Outcomes;
using AutoWebPentester.API.Logic.AllWithPentests.Resources;
using AutoWebPentester.API.Model;
using Newtonsoft.Json;

namespace AutoWebPentester.API.Logic.AllWithPentests.Caretakers
{
    public class SqlAllowedCharacterTester : Caretaker
    {
        public Task<Outcome> CarryOnPentest(WebSite website, IResourceRepository resourceRepo, Input input,int userId)
        {
            JChoosen jChoosen= input.Parts[0] as JChoosen;

            Outcome outcome= new Outcome();
            outcome.JSONOutcome=JsonConvert.SerializeObject(new StandardStringOutcome("Oks"));
           return Task.FromResult<Outcome>(outcome);
        }

        public IEnumerable<Input> FillInput(WebSite website,IResourceRepository resourceRepo,IEnumerable<Input> inputs,int userId)
        {
            
            List<Resource> forms= resourceRepo.GetResourcesByName(website.Id,"Form").Result;
            
            JChoosen main= inputs.First().Parts[0] as JChoosen;


            foreach(Resource  r in forms){
                Form form = r.Content as Form;
                
                JChoosen formChoose= new JChoosen(form.Value);

              
                foreach(var input in form.HtmlInputs){
                    formChoose.Options.Add(new JChoosen(input.Name));
                }    
                
                main.Options.Add(formChoose);  
             }
           
        return inputs;
        }
       
    }
}