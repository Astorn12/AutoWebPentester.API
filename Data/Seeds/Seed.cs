using System.Collections.Generic;
using System.Linq;
using AutoWebPentester.API.Data.HeaderRepositories;
using AutoWebPentester.API.Model;
using Microsoft.EntityFrameworkCore;
using static AutoWebPentester.API.Data.Seeds.PentestSketchTagSeedData;

namespace AutoWebPentester.API.Data.Seeds
{
    public class Seed
    {
        // private DataContext _context;
        // private IHeaderRepository _repo;

        // public Seed(DataContext context, IHeaderRepository repo)
        // {
        //     _context = context;
        //     _repo = repo;
        // }

        public static void SeedHeaders(DataContext context){
            if(!context.Headers.Any()){
            HeaderSeedData headerSeed= new HeaderSeedData();
            context.Headers.AddRange(headerSeed.GetAll());
            context.SaveChanges();
            }
        }

        public static void SeedTagKinds(DataContext context){
                
                context.TagKinds.RemoveRange(context.TagKinds.Where(x=>true).ToList());
                TagKindsSeedData seedData= new TagKindsSeedData();
                context.TagKinds.AddRange(seedData.GetTagKinds());
                context.SaveChanges();
        }

        public static void SeedPentests(DataContext context){
             // if(!context.Pentests.Any()){
                 context.PentestSketches.RemoveRange(context.PentestSketches.Where(x=>true).ToList());
                PentestsSeedData seedData= new PentestsSeedData();
                var list=seedData.GetPentestSeed();
                context.PentestSketches.AddRange(list);
                context.SaveChanges();
           // }
        }

        public static  void SeedPentestTags(DataContext context){
            context.PentestTags.RemoveRange(context.PentestTags.Where(x=>true).ToList());//cleaning database

            PentestSketchTagSeedData seedData= new PentestSketchTagSeedData();
             List<PentestTag> list= new List<PentestTag>();
            foreach(PenTagTmp tmp in seedData.GetAll()){
                PentestSketch pentest=  context.PentestSketches.FirstOrDefault(x=>x.Name.Equals(tmp.PentestName));
                Tag tag=  context.Tags.FirstOrDefault(x=>x.Name.Equals(tmp.TagName));
                list.Add(new PentestTag(pentest.Id, tag.Id));
            }

             context.AddRange(list);
            context.SaveChanges();
        }

        public static void SeedResources(DataContext context){
            context.ResourceSketches.RemoveRange(context.ResourceSketches.ToList());

            PentestsSeedData data= new PentestsSeedData();

            List<ResourceSketch> resources=  data.GetResourceSketchesData();

            context.ResourceSketches.AddRange(resources);

            context.SaveChanges();
        }

        public static void SeedPenRequiredRes(DataContext context){
            context.PentestRequiredResources.RemoveRange(context.PentestRequiredResources.ToList());

            PentestsSeedData data= new PentestsSeedData();
        
            var list= data.GetPentestRequiredData();
            List<PentestRequiredResource> penrests= new List<PentestRequiredResource>();
            foreach(var penres in list){
                PentestSketch pen= context.PentestSketches.FirstOrDefault(x=>x.Name==penres.PentestName);
                ResourceSketch res= context.ResourceSketches.FirstOrDefault(x=>x.Name==penres.ResourceName);

                PentestRequiredResource pr=new PentestRequiredResource(){
                    PentestSketchId=pen.Id,
                    ResourceSketchId=res.Id
                };
                penrests.Add(pr);
            }  

            context.PentestRequiredResources.AddRange(penrests);
            context.SaveChanges();
        }


         public static void SeedPenProvidedRes(DataContext context){
            context.PentestProvidedResources.RemoveRange(context.PentestProvidedResources.ToList());

            PentestsSeedData data= new PentestsSeedData();
        
            var list= data.GetPentestProvidedData();
            List<PentestProvidedResource> penrests= new List<PentestProvidedResource>();
            foreach(var penres in list){
                PentestSketch pen= context.PentestSketches.FirstOrDefault(x=>x.Name==penres.PentestName);
                ResourceSketch res= context.ResourceSketches.FirstOrDefault(x=>x.Name==penres.ResourceName);

                PentestProvidedResource pr=new PentestProvidedResource(){
                    PentestSketchId=pen.Id,
                    ResourceSketchId=res.Id
                };
                penrests.Add(pr);
            }  

            context.PentestProvidedResources.AddRange(penrests);
            context.SaveChanges();
        }

        
    }
}